"use strict";

const screenMD = 768;
const screenLG = 1440;
const screenSM = 320;
let isMobile = window.innerWidth < screenMD;
let isTablet = window.innerWidth >= screenMD && window.innerWidth < screenLG;
let isDesktop = window.innerWidth >= screenLG;
let currentScreen = window.innerWidth;

function checkMobile() {
  isMobile = window.innerWidth < screenMD;
}
checkMobile();

function checkTablet() {
  isTablet = window.innerWidth >= screenMD && window.innerWidth < screenLG;
}
checkTablet();

function checkDesktop() {
  isDesktop = window.innerWidth >= screenLG;
}
checkDesktop();

window.addEventListener("resize", function() {
  checkMobile();
  checkTablet();
  checkDesktop();
  initMap();
  currentScreen = window.innerWidth;

  if (!isMobile) {
    menu.style.height = "auto";
  } else {
    menu.style.height = 0 + "px";
  }

  if (btnMenu.classList.contains("active")) {
    menu.style.height = 0 + "px";
    btnMenu.classList.remove("active");
  }
});

/* MENU
------------------------------------ */
const btnMenu = document.querySelector(".header__toggle-menu--js");
const menu = document.querySelector(".header__main-nav--js");
const menuHeight = menu.offsetHeight;

btnMenu.classList.add("active");
btnMenu.classList.remove("no-js");

function menuClickHandler() {
  if (isMobile) {
    if (btnMenu.classList.contains("active")) {
      menu.style.height = 0 + "px";
      btnMenu.classList.remove("active");
    } else {
      menu.style.height = menuHeight + "px";
      btnMenu.classList.add("active");
    }
  } else {
    menu.style.height = "auto";
  }
}
menuClickHandler();

btnMenu.addEventListener("click", menuClickHandler);

/* MAP
------------------------------------ */
function initMap() {
  const place = { lat: 59.93886158908909, lng: 30.32313322953011 };
  let scale = 14;

  function setScale() {
    if (window.innerWidth >= screenMD && window.innerWidth < screenLG) { scale = 15.5; }
    if (isDesktop) { scale = 17; }
  }
  setScale();

  window.addEventListener("resize", setScale);

  const map = new google.maps.Map(document.querySelector(".footer__contacts-map--js"), {
    center: place,
    zoom: scale
  });

  const marker = new google.maps.Marker({
    map: map,
    position: place,
    icon: { url: "https://b-lvlax.github.io/stuff/cat-energy/img/map/map-pin.png" },
    scaledSize: google.maps.Size(20, 20),
    animation: google.maps.Animation.BOUNCE
  });
}

/* RANGE Slider
------------------------------------ */
if (document.documentElement.classList.contains("index-page")) {
  const slider = document.querySelector(".example__slider");
  const range = document.querySelector(".example__slider-range--js");
  const slide = document.querySelector(".example__slider-slide--js");
  const value = "100";

  function setSliderValue() {
    if (isMobile) {
      range.setAttribute("value", 0);
      range.step = value;
      slide.style.width = value + "%";
    } else {
      if (isDesktop) {
        slide.style.width = "57.4%";
      } else {
        range.setAttribute("value", value / 2);
        range.step = 1;
        slide.style.width = value / 2 + "%";
      }
    }
  }
  setSliderValue();

  function showBg() {
    if (+range.value === 0 && isDesktop) {
      slider.classList.add("show-bg");
    } else {
      slider.classList.remove("show-bg");
    }
  }

  function compare() {
    slide.style.width = +value - range.value + "%";
    showBg();
  }

  range.addEventListener("click", compare);
  range.addEventListener("input", compare);
  window.addEventListener("resize", setSliderValue);

  /* COMPARE With BTN */

  const btns = document.querySelectorAll(".example__slider-btn--js");

  btns[0].addEventListener("click", function() {
    slide.style.width = value + "%";
    range.value = 0;
    showBg();
  });

  btns[1].addEventListener("click", function() {
    slide.style.width = 0 + "%";
    range.value = value;
    showBg();
  });
}

/* FORM
------------------------------------ */
if (document.documentElement.classList.contains("form-page")) {
  const form = document.querySelector(".form");
  const formBtn = form.querySelector(".form__btn-submit--js");
  const formFields = form.querySelectorAll("input[required]");
  let invalidFields = [];
  let isValid = true;

  formBtn.addEventListener("click", function(e) {
    form.setAttribute("novalidate", true);
  });

  function checkField(field) {
    if (!field.value) {
      field.classList.add("error");
      isValid = false;
      invalidFields.push(field);
    } else {
      field.classList.remove("error");
      isValid = true;
    }
  }

  form.addEventListener("submit", function(e) {
    invalidFields = [];

    formFields.forEach(function(el) {
      checkField(el);
    });

    if (!isValid) {
      e.preventDefault();
      invalidFields[0].focus();
    }
  });
}
